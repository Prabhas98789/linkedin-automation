<!DOCTYPE html>
<html lang="en" class="bg-gray-50">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Sequence</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body x-data="sequencePage()" class="min-h-screen bg-gray-50 text-gray-800 font-sans px-4 py-6">
  <div class="max-w-4xl mx-auto space-y-6">
    <h1 class="text-2xl font-bold">Create New Sequence</h1>

    <!-- Filters -->
    <div class="bg-white p-4 rounded-lg shadow space-y-4">
      <h2 class="text-lg font-semibold">Target Filters</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="text" x-model="filters.location" placeholder="Location (e.g., India)"
               class="border border-gray-300 rounded px-4 py-2" />
        <input type="text" x-model="filters.title" placeholder="Job Title (e.g., Software Engineer)"
               class="border border-gray-300 rounded px-4 py-2" />
      </div>
    </div>

    <!-- Steps -->
    <div class="bg-white p-4 rounded-lg shadow space-y-4">
      <h2 class="text-lg font-semibold">Steps</h2>
      <template x-for="(step, index) in steps" :key="index">
        <div class="border p-3 rounded flex flex-col space-y-2">
          <div class="flex justify-between items-center">
            <select x-model="step.type" class="border px-2 py-1 rounded">
              <option value="connect">Connect</option>
              <option value="like">Like</option>
              <option value="comment">Comment</option>
              <option value="message">Message</option>
            </select>
            <button @click="removeStep(index)" class="text-red-500 hover:underline text-sm">Remove</button>
          </div>
          <div x-show="step.type === 'message'">
            <textarea x-model="step.message" placeholder="Enter your message or prompt..."
                      class="border px-3 py-2 rounded w-full"></textarea>
            <label class="inline-flex items-center mt-2">
              <input type="checkbox" x-model="step.use_ai" class="mr-2">
              <span class="text-sm text-gray-600">Generate message with AI</span>
            </label>
          </div>
        </div>
      </template>
      <button @click="addStep" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
        ➕ Add Step
      </button>
    </div>

    <!-- Submit -->
    <div class="text-right">
      <button @click="submitSequence"
              class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded shadow">
        ✅ Create Sequence
      </button>
    </div>
  </div>

  <script>
    function sequencePage() {
      return {
        filters: {
          location: '',
          title: ''
        },
        steps: [],

        addStep() {
          this.steps.push({ type: 'connect', message: '', use_ai: false });
        },
        removeStep(index) {
          this.steps.splice(index, 1);
        },
        async submitSequence() {
          const payload = {
            filters: this.filters,
            steps: this.steps
          };
          console.log("Submitting Sequence:", payload);

          // TODO: Replace with real endpoint
          try {
            const res = await fetch("https://n8n.sapidblue.in/webhook/create-sequence-entry", {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            const result = await res.json();
            alert("Sequence created successfully!");
          } catch (e) {
            alert("Failed to create sequence.");
            console.error(e);
          }
        }
      };
    }
  </script>
</body>
</html>
